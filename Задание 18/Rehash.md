# Постановка задачи

Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, ni предмет имеет массу wi > 0 и стоимость pi > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна.

# Условия задачи

| Предметы  |  A  |  B  |  C  |  D  |  E  |
| :-------- | :-: | :-: | :-: | :-: | :-: |
| Стоимость |  3  |  4  |  6  |  8  |  3  |
| Вес       |  6  |  4  |  2  |  4  | 12  |

Ограничение вместимости: 16

# Шаг 1

Сортируем предметы по их ценности $(\frac {Стоимость}{вес})$

| Предметы  |  A  |  B  |  C  |  D  |  E   |
| :-------- | :-: | :-: | :-: | :-: | :--: |
| Стоимость |  3  |  4  |  6  |  8  |  3   |
| Вес       |  6  |  4  |  2  |  4  |  12  |
| Ценность  | 0.5 |  1  |  3  |  2  | 0.25 |

| Предметы  |  C  |  D  |  B  |  A  |  E   |
| :-------- | :-: | :-: | :-: | :-: | :--: |
| Стоимость |  6  |  8  |  4  |  3  |  3   |
| Вес       |  2  |  4  |  4  |  6  |  12  |
| Ценность  |  3  |  2  |  1  | 0.5 | 0.25 |

# Шаг 2

Представим, что самого ценного предмета из тех, что еще не обработаны, у нас бесконечное количество и мы можем делить его на сколь угодно малые части. Тогда мы можем все оставшееся в рюкзаке место заполнить этим предметом. Тогда ценность будет

$$
3 * 16 = 48
$$

Это значение будет корнем нашего дерева, оно представляет оценку перспективности для задачи в целом.

# Шаг 3

Разобьем множество решений на два подмножества и начнем строить дерево. Левым потомком будет подмножество решений, в которых мы взяли самый ценный из оставшихся предметов, правым - где не взяли.

Оценка перспективности левого потомка =

$$
6 + (16 - 2) * 2 = 34
$$

Оценка перспективности правого потомка =

$$
16 * 2 = 32
$$

```mermaid
flowchart TD
1(48)
2(34)
3(32)
1 -- +C--> 2
1 -- -C--> 3

style 2 fill:#4f4
```

Повторяем шаг 3 и продолжаем строить дерево из самой перспективной вершины.

Оценка перспективности левого потомка =

$$
6 + 8 + (16 - 2 - 4) * 1 = 24
$$

Оценка перспективности правого потомка =

$$
6 + (16 - 2) * 1 = 20
$$

```mermaid
flowchart TD
1(48)
2(34)
3(32)
4(24)
5(20)
1 -- +C--> 2
1 -- -C--> 3
2 -- +D--> 4
2 -- -D--> 5

style 3 fill:#4f4
```

Заметим, что самая перспективная вершина оказалась на другой ветке. Продолжаем строить из вершины с оценкой 32.

Оценка перспективности левого потомка =

$$
8 + (16 - 4) * 1 = 20
$$

Оценка перспективности правого потомка =

$$
16 * 1 = 16
$$

```mermaid
flowchart TD
1(48)
2(34)
3(32)
4(24)
5(20)
6(20)
7(16)

1 -- +C--> 2
1 -- -C--> 3
2 -- +D--> 4
2 -- -D--> 5
3 -- +D--> 6
3 -- -D--> 7

style 4 fill:#4f4
```

Самая перспективная вершина - 24.

Оценка перспективности левого потомка =

$$
6 + 8 + 4 + (16 - 2 - 4 - 4) * 0.5 = 21
$$

Оценка перспективности правого потомка =

$$
6 + 8 + (16 - 2 - 4) * 0.5 = 19
$$

```mermaid
flowchart TD
1(48)
2(34)
3(32)
4(24)
5(20)
6(20)
7(16)
8(21)
9(19)

1 -- +C--> 2
1 -- -C--> 3
2 -- +D--> 4
2 -- -D--> 5
3 -- +D--> 6
3 -- -D--> 7
4 -- +B--> 8
4 -- -B--> 9

style 8 fill:#4f4
```

Самая перспективная вершина - 21.

Оценка перспективности левого потомка =

$$
6 + 8 + 4 + 3 + (16 - 2 - 4 - 4 - 6) * 0.25 = 21
$$

Оценка перспективности правого потомка =

$$
6 + 8 + 4 + (16 - 2 - 4 - 4) * 0.25 = 19.5
$$

```mermaid
flowchart TD
1(48)
2(34)
3(32)
4(24)
5(20)
6(20)
7(16)
8(21)
9(19)
10(21)
11(19,5)

1 -- +C--> 2
1 -- -C--> 3
2 -- +D--> 4
2 -- -D--> 5
3 -- +D--> 6
3 -- -D--> 7
4 -- +B--> 8
4 -- -B--> 9
8 -- +A--> 10
8 -- -A--> 11

style 10 fill:#4f4
```

Самая перспективная вершина - 21.

При оценке перспективности левого потомка мы упираемся в лимит рюкзака, который мы не можем превысить, т.е. $16 - 2 - 4 - 4 - 6 - 12 = -12$. Соответственно от этой вершины мы не будем продолжать поиск.

Оценка перспективности правого потомка =

$$
6 + 8 + 4 + 3 + (16 - 2 - 4 - 4 - 6) * 0 = 21
$$

```mermaid
flowchart TD
1(48)
2(34)
3(32)
4(24)
5(20)
6(20)
7(16)
8(21)
9(19)
10(21)
11(19,5)
12(X)
13(21)

1 -- +C--> 2
1 -- -C--> 3
2 -- +D--> 4
2 -- -D--> 5
3 -- +D--> 6
3 -- -D--> 7
4 -- +B--> 8
4 -- -B--> 9
8 -- +A--> 10
8 -- -A--> 11
10 -- +E--> 12
10 -- -E--> 13

style 13 fill:#4f4
style 12 fill:#FF0000
```

Поскольку мы опустились до самого нижнего уровня (рассмотрели все предметы) и вершина на самом нижнем уровне является самой перспективной, то это и будет ответом.

Чтобы восстановить все положенные в рюкзак предметы пройдемся по ребрам, которые привели нас к ответу.

# Ответ

В рюкзак пойдут предметы A, B, D, C. Максимальная стоимость рюкзака: 3 + 4 + 6 + 8 = 21.
