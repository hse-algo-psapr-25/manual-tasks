# Задание №16

## Вариант №3

## Задача о максимальном потоке.

1. Дана сеть (взвешенный ориентированный граф) с источником s и стоком t.
2. Для каждой дуги определена ее пропускная способность.
3. Необходимо найти максимальный поток для указанной сети.

#### Пропускная способность дуг сети указана в таблице.

|          Дуги          | sa  | sb  | ac  | ba  | bc  | bd  | cd  | dt  | ct  |
| :--------------------: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| Пропускная способность |  1  |  5  |  4  |  1  |  3  |  7  |  8  | 12  |  3  |

### 1. Построим сеть с источником s, стоком t и указанными пропускными способностями дуг.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1| a
    s -->|5| b
    a -->|4| c
    b -->|1| a
    b -->|3| c
    b -->|7| d
    c -->|8| d
    d -->|12| t
    c -->|3| t
```

Построим остаточную сеть. Так как изначально поток в сети не задан, все дуги сети являются пустыми (локальный поток равен нулю), соответственно в остаточную сеть необходимо вынести обратную дугу с весом равным пропускной способности.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    a -->|1| s
    b -->|5| s
    c -->|4| a
    a -->|1| b
    c -->|3| b
    d -->|7| b
    d -->|8| c
    t -->|12| d
    t -->|3| c
```

### 2. Проведем поиск увеличивающего пути в остаточной сети

В остаточной сети найден увеличивающий путь t -> c -> b -> s. Минимальный вес дуг на этом пути равен 3.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    a -->|1| s
    b -->|5| s
    c -->|4| a
    a -->|1| b
    c -->|3| b
    d -->|7| b
    d -->|8| c
    t -->|12| d
    t -->|3| c

    linkStyle 1,4,8 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    a -->|1| s
    b -->|2| s
    c -->|4| a
    a -->|1| b
    b -->|3| c
    d -->|7| b
    d -->|8| c
    t -->|12| d
    c -->|3| t
    
    s -->|3| b
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|0,1| a
    s -->|3,5| b
    a -->|0,4| c
    b -->|0,1| a
    b -->|3,3| c
    b -->|0,7| d
    c -->|0,8| d
    d -->|0,12| t
    c -->|3,3| t
```

### 3. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> d -> c -> a -> s. Минимальный вес дуг на этом пути равен 1.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    a -->|1| s
    b -->|2| s
    c -->|4| a
    a -->|1| b
    b -->|3| c
    d -->|7| b
    d -->|8| c
    t -->|12| d
    c -->|3| t
    
    s -->|3| b

    linkStyle 0,2,6,7 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1| a
    b -->|2| s
    c -->|3| a
    a -->|1| b
    c -->|3| b
    d -->|7| b
    d -->|7| c
    t -->|11| d
    c -->|3| t
    
    s -->|3| b
    a -->|1| c
    c -->|1| d
    d -->|1| t
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1,1| a
    s -->|3,5| b
    a -->|1,4| c
    b -->|0,1| a
    b -->|3,3| c
    b -->|0,7| d
    c -->|1,8| d
    d -->|1,12| t
    c -->|3,3| t
```

### 4. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> d -> b -> s. Минимальный вес дуг на этом пути равен 2.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1| a
    b -->|2| s
    c -->|3| a
    a -->|1| b
    c -->|3| b
    d -->|7| b
    d -->|7| c
    t -->|11| d
    c -->|3| t
    
    s -->|3| b
    a -->|1| c
    c -->|1| d
    d -->|1| t

    linkStyle 1,5,7 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1| a
    s -->|2| b
    s -->|3| b
    c -->|3| a
    a -->|1| b
    c -->|3| b
    d -->|5| b
    d -->|7| c
    t -->|9| d
    c -->|3| t
    
    s -->|3| b
    a -->|1| c
    c -->|1| d
    d -->|3| t
    b -->|2| d
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1,1| a
    s -->|5,5| b
    a -->|1,4| c
    b -->|0,1| a
    b -->|3,3| c
    b -->|2,7| d
    c -->|1,8| d
    d -->|3,12| t
    c -->|3,3| t
```

### 5. Продолжим поиск увеличивающего пути

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 6 является максимальным для данной сети.

### 6. Проверим значение максимального потока перебором всех разрезов сети.

Разрез сети - разбиение множества вершин на два подмножества $V_1$ и $V_2$, где во множество $V_1$ входит источник, а в $V_2$ входит сток.

Пропускная способность разреза - сумма пропускной способности дуг, начинающихся в вершинах из множества $V_1$ и оканчивающихся в вершинах из $V_2$.

Для сети из _n_ вершин существует $2^{n - 2}$ различных разрезов, так как две вершины из множества (источник и сток) "зафиксированы" в $V_1$ и $V_2$, остальные вершины можно различными способами распределять между множествами $V_1$ и $V_2$.

Для сети из 6 вершин нужно найти $2^{6-2}$ = $2^4$ = 16 разрезов.

| №   | V₁          | V₂          | Пропускная способность                                  |
| --- | ----------- | ----------- | ------------------------------------------------------- |
| 1   | {s}         | {a,b,c,d,t} | 1 + 5 = **6**                                           |
|     | {**s + **одна вершина из a, b, c, d**}                                              |            
| 2   | {s,a}       | {b,c,d,t}   | 5 + 4 = 9                                               |
| 3   | {s,b}       | {a,c,d,t}   | 1 + 1 + 3 + 7 = 12                                      |
| 4   | {s,c}       | {a,b,d,t}   | 1 + 5 + 8 + 3 = 17                                      |
| 5   | {s,d}       | {a,b,c,t}   | 1 + 5 + 12 = 18                                         |
|     | {**s + пара вершин из a, b, c, d**}                                                 |                                          |
| 6   | {s,a,b}     | {c,d,t}     | 4 + 3 + 7 = 14                                          |
| 7   | {s,a,c}     | {b,d,t}     | 5 + 8 + 3 = 16                                      |
| 8   | {s,a,d}     | {b,c,t}     | 5 + 4 + 12 = 21                                         |
| 9   | {s,b,c}     | {a,d,t}     | 1 + 1 + 7 + 8 + 3 = 20                                      |
| 10  | {s,b,d}     | {a,c,t}     | 1 + 1 + 3 + 12 = 17                                     |
| 11  | {s,c,d}     | {a,b,t}     | 1 + 5 + 3 + 12 = 21                                           |
|     | {**s + три вершины из a, b, c, d**}                                                 |                                          |
| 12  | {s,a,b,c}   | {d,t}       | 7 + 8 + 3 = 18                                          |
| 13  | {s,a,b,d}   | {c,t}       | 4 + 3 + 12 = 19                                         |
| 14  | {s,a,c,d}   | {b,t}       | 5 + 3 + 12 = 20                                           |
| 15  | {s,b,c,d}   | {a,t}       | 1 + 1 + 3 + 12 = 17                                               |
|     | {**s + четыре вершины из a, b, c, d**}                                                 |                                               |
| 16  | {s,a,b,c,d} | {t}         | 12 + 3 = 15                                             |

Минимальная пропускная способность разреза равна 6 ({s} / {a,b,c,d,t}), что совпадает с найденной величиной максимального потока в сети.

### Ответ:

Максимальный поток в сети равен 6, он реализуется следующим локальными потоками:

```mermaid
graph LR
    s((s))
    a((a))
    b((b))
    c((c))
    d((d))
    t((t))

    s -->|1,1| a
    s -->|5,5| b
    a -->|1,4| c
    b -->|0,1| a
    b -->|3,3| c
    b -->|2,7| d
    c -->|1,8| d
    d -->|3,12| t
    c -->|3,3| t
```