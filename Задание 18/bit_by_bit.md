# Вариант 4
## Постановка задачи
Задача о рюкзаке (англ. Knapsack problem) — дано N предметов, n<sub>i</sub> предмет имеет массу w<sub>i</sub> > 0 и стоимость p<sub>i</sub> > 0. Необходимо выбрать из этих предметов такой набор, чтобы суммарная масса не превосходила заданной величины W (вместимость рюкзака), а суммарная стоимость была максимальна. 

## Условия задачи
|    **Предметы**   | **A** | **B** | **C** | **D** | **E** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   4   |   3   |   3   |   8   |   6   |
| **Вес**           |   8  |  3   |   12   |   4   |   2   |

Ограничение вместимости - 16 у.е.
Сложим вес всех предметов: 8 + 3 + 12 + 4 + 2 = 29 > 16, значит все предметы не помещаются в рюкзак.

## Шаг 1. Вычисляем ценность каждого предмета и сортируем
Ценность предмета - это отношение его стоимости к весу: c<sub>i</sub> = s<sub>i</sub>/w<sub>i</sub>
Ценность каждого предмета:
|    **Предметы**   | **A** | **B** | **C** | **D** | **E** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   4   |   3   |   3   |   8   |   6   |
| **Вес**           |   8   |   3   |   12   |  4   |  2   |
| **Ценность**      |$\frac{1}{2}$|   1   |$\frac{1}{4}$|  2  |  3  |

Сортируем предметы в порядке уменьшения их ценности

|    **Предметы**   | **E** | **D** | **B** | **A** | **С** |
|-------------------|:-----:|:-----:|:-----:|:-----:|:-----:|
| **Стоимость**     |   6   |   8   |   3   |   4   |   3   |
| **Вес**           |   2   |   4   |   3   |  8   |  12   |
| **Ценность**      |   3   |   2   |   1   |$\frac{1}{2}$|$\frac{1}{4}$|

## Шаг 2. Вычислим оценку перспективности (Оценка корня дерева)
Представим, что самого ценного предмета из тех, что еще не обработаны, у нас бесконечное количество и мы можем делить его на сколь угодно малые части. Тогда мы можем все оставшееся в рюкзаке место заполнить этим предметом. Тогда ценность будет

$$
3 * 16 = 48
$$

Это значение будет корнем нашего дерева, оно представляет оценку перспективности для задачи в целом. Стоимость рюкзака ни при каком варианте не может превысить 48.

## Шаг 3. Ветвление из корня по предмету E
Разобьем множество решений на два подмножества и начнем строить дерево. Левым потомком будет подмножество решений, в которых мы взяли самый ценный из оставшихся предметов, правым - где не взяли. 
* Левый потомок: предмет E кладём в рюкзак
* Правый потомок: предмет E не кладём в рюкзак

Оценка перспективности левого потомка:
* Вес предмета E = 2, поэтому остается вместимость 16 - 2 = 14
* Стоимость в рюкзаке: 0 + 6 = 6
* У следующего предмета ценность 2

$$
6 + 14 * 2 = 6 + 28 = 34
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 16
* Стоимость в рюкзаке: 0
* У следующего предмета ценность 2

$$
16 * 2 = 32
$$


``` mermaid
flowchart TD
A(48)
B(34)
C(32)
A -- +E--> B
A -- -E--> C

style B fill:#4f4f
```

Повторяем шаг 3 и продолжаем строить дерево из самой перспективной вершины.

Шаг 4. Ветвление из узла, где E кладём в рюкзак

* Левый потомок: предмет E кладём в рюкзак, и предмет D кладём в рюкзак
* Правый потомок: предмет E кладём в рюкзак, а предмет D не кладём в рюкзак

Оценка перспективности левого потомка:
* Вес предмета E = 2, D = 4, поэтому остается вместимость 16 - (2 + 4) = 10
* Стоимость в рюкзаке: 6 + 8 = 14
* У следующего предмета ценность 1

$$
14 + 10 * 1 = 24
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 16 - 2 = 14
* Стоимость в рюкзаке: 6
* У следующего предмета ценность 1

$$
6 + 14 * 1 = 20
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E

style C fill:#4f4f
```

Заметим, что самая перспективная вершина оказалась на другой ветке. Продолжаем строить из вершины с оценкой 32.

Шаг 5. Ветвление из узла, где E не взят в рюкзак

* Левый потомок: предмет E не кладём в рюкзак, предмет D кладём в рюкзак
* Правый потомок: предмет E не кладём в рюкзак, и предмет D не кладём в рюкзак

Оценка перспективности левого потомка:
* Вес предмета D = 4, поэтому остается вместимость 16 - 4 = 12
* Стоимость в рюкзаке: 0 + 8 = 8
* У следующего предмета ценность 1

$$
8 + 12 * 1 = 20
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 16
* Стоимость в рюкзаке: 0
* У следующего предмета ценность 1

$$
16 * 1 = 16
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G

style D fill:#4f4f
```

Самая перспективная вершина - 24.

Шаг 6. Ветвление из узла, где E и D взяты в рюкзак

* Левый потомок: предмет E и D взяты в рюкзак, предмет B кладём в рюкзак
* Правый потомок: предмет E и D взяты в рюкзак, предмет B не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 2 + 4 + 3 = 9, значит остаточная вместимость: 16 - 9 = 7
* Стоимость в рюкзаке: 6 + 8 + 3 = 17
* У следующего предмета ценность $\frac{1}{2}$

$$
17 + 7 * \frac{1}{2} = 20.5
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 10, так как положили уже E и D
* Стоимость в рюкзаке: 14
* У следующего предмета ценность $\frac{1}{2}$

$$
14 + 10 * \frac{1}{2} = 19
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I

style H fill:#4f4f
```

Самая перспективная вершина - 20.5.

Шаг 7. Ветвление из узла, где E и D взяты в рюкзак

* Левый потомок: предметы E, D, B взяты в рюкзак, предмет A тоже кладём в рюкзак
* Правый потомок: предметы E, D, B взяты в рюкзак, предмет A не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 9 + 8 = 17, но 17 > 16, **значит предмет A не помещается в рюкзак!**

Оценка перспективности правого потомка: 
* Остаточная вместимость: 7
* Стоимость в рюкзаке: 17
* У следующего предмета ценность $\frac{1}{4}$

$$
17 + 7 * \frac{1}{4} = 18.75
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
J(0)
K(18.75)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I
H -- +A--> J
H -- -A--> K

style E fill:#4f4f
style F fill:#FF0000
```

Самая перспективная вершина - 20.

Шаг 8. Ветвление из узла, где E взят, а D не взят в рюкзак

* Левый потомок: предмет E взят, D не взят в рюкзак, предмет B кладём в рюкзак
* Правый потомок: предмет E взят, D не взят в рюкзак, предмет B не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 2 + 3 = 5, значит остаточная вместимость: 16 - 5 = 11
* Стоимость в рюкзаке: 6 + 3 = 9
* У следующего предмета ценность $\frac{1}{2}$

$$
9 + 11 * \frac{1}{2} = 14.5
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 14, в рюкзаке только E
* Стоимость в рюкзаке: 6
* У следующего предмета ценность $\frac{1}{2}$

$$
6 + 14 * \frac{1}{2} = 13
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
J(0)
K(18.75)
L(14.5)
M(13)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I
H -- +A--> J
H -- -A--> K
E -- +B--> L
E -- -B--> M

style F fill:#4f4f
```

Самая перспективная вершина - 20

Шаг 9. Ветвление из узла, где E не взят, а D взят в рюкзак

* Левый потомок: предмет D взят, предмет B кладём в рюкзак
* Правый потомок: предмет D взят, предмет B не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 4 + 3 = 7, значит остаточная вместимость: 16 - 7 = 9
* Стоимость в рюкзаке: 8 + 3 = 11
* У следующего предмета ценность $\frac{1}{2}$

$$
11 + 9 * \frac{1}{2} = 15.5
$$

Оценка перспективности правого потомка: 
* Остаточная вместимость: 12, в рюкзаке только D
* Стоимость в рюкзаке: 8
* У следующего предмета ценность $\frac{1}{2}$

$$
8 + 12 * \frac{1}{2} = 14
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
J(0)
K(18.75)
L(14.5)
M(13)
N(15.5)
O(14)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I
H -- +A--> J
H -- -A--> K
E -- +B--> L
E -- -B--> M
F -- +B--> N
F -- -B--> O

style I fill:#4f4f
```

Самая перспективная вершина - 19.

Шаг 10. Ветвление из узла, где E и D взяты, а B не взят в рюкзак

* Левый потомок: предметы E и D взяты, B не взят, предмет A кладём в рюкзак
* Правый потомок: предметы E и D взяты, B не взят, предмет A не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 2 + 4 + 8 = 14, значит остаточная вместимость: 16 - 14 = 2
* Стоимость в рюкзаке: 6 + 8 + 4 = 18
* У следующего предмета ценность $\frac{1}{4}$

$$
18 + 2 * \frac{1}{4} = 18.5
$$

Оценка перспективности правого потомка:
* Остаточная вместимость: 10, в рюкзаке E и  D
* Стоимость в рюкзаке: 14
* У следующего предмета ценность $\frac{1}{4}$

$$
14 + 10 * \frac{1}{4} = 16.5
$$

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
J(0)
K(18.75)
L(14.5)
M(13)
N(15.5)
O(14)
P(18.5)
R(16.5)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I
H -- +A--> J
H -- -A--> K
E -- +B--> L
E -- -B--> M
F -- +B--> N
F -- -B--> O
I -- +A--> P
I -- -A--> R

style K fill:#4f4f
```
Самая перспективная вершина - 18.75

Шаг 11. Ветвление из узла, где E, D, B взяты, а A не взят в рюкзак

* Левый потомок: предметы где E, D, B взяты, A не взят, а предмет C кладём в рюкзак
* Правый потомок: предметы где E, D, B взяты, A не взят, но предмет C не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 9 + 12 = 21, но 21 > 16
Значит предмет C не помещается в рюкзак!

Оценка перспективности правого потомка:
* Стоимость: 6 + 8 + 3 = 17, в рюкзаке E, D и B
* Вес: 2 + 4 + 3 = 9
Концевая вершина в дереве (все 5 предметов рассмотрены). Её оценка перспективности - это реальная стоимость набора, т.е. 17

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
J(0)
K(18.75)
L(14.5)
M(13)
N(15.5)
O(14)
P(18.5)
R(16.5)
S(0)
T(17)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I
H -- +A--> J
H -- -A--> K
E -- +B--> L
E -- -B--> M
F -- +B--> N
F -- -B--> O
I -- +A--> P
I -- -A--> R
K -- +C--> S
K -- -C--> T

style P fill:#4f4f
```
Самая перспективная вершина - 18.5

Шаг 12. Ветвление из узла, где E, D, A взяты, а B не взят в рюкзак

* Левый потомок: предметы E, D, A взяты, B не взят, предмет C кладём в рюкзак
* Правый потомок: предметы E, D, A взяты, B не взят, предмет C не кладём в рюкзак

Оценка перспективности левого потомка:
* Суммарный вес: 14 + 12 = 26
26 > 16 - предмет C не помещается в рюкзак!

Оценка перспективности правого потомка:
* Вес: 2 + 4 + 8, в рюкзаке E, D, A
* Стоимость в рюкзаке: 6 + 8 + 4 = 18
Концевая вершина в дереве (все 5 предметов рассмотрены). Её оценка перспективности - это реальная стоимость набора, т.е. 18

``` mermaid
flowchart TD
A(48)
B(34)
C(32)
D(24)
E(20)
F(20)
G(16)
H(20,5)
I(19)
J(0)
K(18.75)
L(14.5)
M(13)
N(15.5)
O(14)
P(18.5)
R(16.5)
S(0)
T(17)
U(0)
V(18)
A -- +E--> B
A -- -E--> C
B -- +D--> D
B -- -D--> E
C -- +D--> F
C -- -D--> G
D -- +B--> H
D -- -B--> I
H -- +A--> J
H -- -A--> K
E -- +B--> L
E -- -B--> M
F -- +B--> N
F -- -B--> O
I -- +A--> P
I -- -A--> R
K -- +C--> S
K -- -C--> T
P -- +C--> U
P -- -C--> V

linkStyle 0 stroke:green,stroke-width:2px
linkStyle 2 stroke:green,stroke-width:2px
linkStyle 7 stroke:green,stroke-width:2px
linkStyle 14 stroke:green,stroke-width:2px
linkStyle 19 stroke:green,stroke-width:2px
style V fill:#4f4f
```

Поскольку мы опустились до самого нижнего уровня (рассмотрели все предметы) и вершина на самом нижнем уровне является самой перспективной, то это и будет ответом.

Чтобы восстановить все положенные в рюкзак предметы пройдемся по ребрам, которые привели нас к ответу.

## Ответ
В рюкзак пойдут предметы E, D, A. Максимальная стоимость рюкзака: 6 + 8 + 4 = 18.
Общий вес: 2 + 4 + 8 = 14. Свободное место: 16 - 14 = 2