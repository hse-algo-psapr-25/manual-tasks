# Задание №16

# Задача о максимальном потоке.

1. Дана сеть (взвешенный ориентированный граф) с источником s и стоком t.
2. Для каждой дуги определена ее пропускная способность.
3. Необходимо найти максимальный поток для указанной сети.

### Вариант 9:

#### Пропускная способность дуг сети:

|          Дуги          | sa  | ac  | sd  | ab  | cb  | dc  | bt  | ct  | dt  |
| :--------------------: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| Пропускная способность | 10  |  6  |  7  |  5  |  4  |  3  |  8  |  4  |  5  |

### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|10| a
    s -->|7| d
    a -->|6| c
    a -->|5| b
    d -->|3| c
    d -->|5| t
    c -->|4| b
    c -->|4| t
    b -->|8| t
```

Построим остаточную сеть. Так как изначально поток в сети не задан, все дуги сети являются пустыми (локальный поток равен нулю), соответственно в остаточную сеть необходимо вынести обратную дугу с весом равным пропускной способности.

```mermaid
graph RL
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    t -->|8| b
    t -->|4| c
    b -->|4| c
    t -->|5| d
    c -->|3| d
    b -->|5| a
    c -->|6| a
    d -->|7| s
    a -->|10| s

```

### 2. Проведем поиск увеличивающего пути в остаточной сети

В остаточной сети найден увеличивающий путь t -> d -> s. Минимальный вес дуг на этом пути равен 5.

```mermaid
graph RL
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    t -->|8| b
    t -->|4| c
    b -->|4| c
    t -->|5| d
    c -->|3| d
    b -->|5| a
    c -->|6| a
    d -->|7| s
    a -->|10| s

    linkStyle 3,7 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|5| a
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|6| a
    s -->|5| d
    a -->|10| s
    t -->|8| b
    t -->|4| c
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|0,10| a
    s -->|5,7| d
    a -->|0,6| c
    a -->|0,5| b
    d -->|0,3| c
    d -->|5,5| t
    c -->|0,4| b
    c -->|0,4| t
    b -->|0,8| t
```

### 3. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> b -> a -> s. Минимальный вес дуг на этом пути равен 5.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|5| a
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|6| a
    s -->|5| d
    a -->|10| s
    t -->|8| b
    t -->|4| c

    linkStyle 1,8,7 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|1| a
    b -->|4| t
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|6| a
    s -->|5| d
    s -->|4| a
    a -->|6| s
    a -->|4| b
    t -->|4| b
    t -->|4| c
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|4,10| a
    s -->|5,7| d
    a -->|0,6| c
    a -->|4,5| b
    d -->|0,3| c
    d -->|5,5| t
    c -->|0,4| b
    c -->|0,4| t
    b -->|4,8| t
```

### 4. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> c -> a -> s. Минимальный вес дуг на этом пути равен 4.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|1| a
    b -->|4| t
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|6| a
    s -->|5| d
    s -->|4| a
    a -->|6| s
    a -->|4| b
    t -->|4| b
    t -->|4| c

    linkStyle 12,6,9 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|1| a
    b -->|4| t
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|2| a
    c -->|4| t
    s -->|5| d
    s -->|8| a
    a -->|2| s
    a -->|4| b
    a -->|4| c
    t -->|4| b
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|8,10| a
    s -->|5,7| d
    a -->|4,6| c
    a -->|4,5| b
    d -->|0,3| c
    d -->|5,5| t
    c -->|0,4| b
    c -->|4,4| t
    b -->|4,8| t
```

### 5. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> b -> a -> s. Минимальный вес дуг на этом пути равен 1.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|1| a
    b -->|4| t
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|2| a
    c -->|4| t
    s -->|5| d
    s -->|8| a
    a -->|2| s
    a -->|4| b
    a -->|4| c
    t -->|4| b

    linkStyle 1,13,10 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|5| t
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|2| a
    c -->|4| t
    s -->|5| d
    s -->|9| a
    a -->|1| s
    a -->|5| b
    a -->|4| c
    t -->|3| b
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|9,10| a
    s -->|5,7| d
    a -->|4,6| c
    a -->|5,5| b
    d -->|0,3| c
    d -->|5,5| t
    c -->|0,4| b
    c -->|4,4| t
    b -->|5,8| t
```

### 6. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> b -> с -> d -> s. Минимальный вес дуг на этом пути равен 2.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|4| c
    b -->|5| t
    d -->|5| t
    d -->|2| s
    c -->|3| d
    c -->|2| a
    c -->|4| t
    s -->|5| d
    s -->|9| a
    a -->|1| s
    a -->|5| b
    a -->|4| c
    t -->|3| b

    linkStyle 12,0,4,3 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| c
    b -->|7| t
    d -->|5| t
    d -->|4| s
    d -->|2| c
    c -->|5| d
    c -->|2| a
    c -->|2| b
    c -->|4| t
    s -->|7| d
    s -->|9| a
    a -->|1| s
    a -->|5| b
    a -->|4| c
    t -->|1| b
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|9,10| a
    s -->|7,7| d
    a -->|4,6| c
    a -->|5,5| b
    d -->|2,3| c
    d -->|5,5| t
    c -->|2,4| b
    c -->|4,4| t
    b -->|7,8| t
```

### 7. Продолжим поиск увеличивающего пути

В остаточной сети найден увеличивающий путь t -> b -> с -> a -> s. Минимальный вес дуг на этом пути равен 2.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| c
    b -->|7| t
    d -->|5| t
    d -->|4| s
    d -->|2| c
    c -->|5| d
    c -->|2| a
    c -->|2| b
    c -->|4| t
    s -->|7| d
    s -->|9| a
    a -->|1| s
    a -->|5| b
    a -->|4| c
    t -->|1| b

    linkStyle 14,0,6,11 stroke:red,stroke-width:2px
```

Уменьшим вес дуг на найденном пути, дуги для которых вес стал нулевым удалим из остаточной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|1| c
    b -->|8| t
    d -->|5| t
    d -->|4| s
    d -->|2| c
    c -->|5| d
    c -->|1| a
    c -->|3| b
    c -->|4| t
    s -->|7| d
    s -->|10| a
    a -->|5| b
    a -->|5| c
```

Скорректируем соответствующим образом локальные потоки в исходной сети. Первым числом будем указывать локальный поток, вторым пропускную способность дуги.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|10,10| a
    s -->|7,7| d
    a -->|5,6| c
    a -->|5,5| b
    d -->|2,3| c
    d -->|5,5| t
    c -->|3,4| b
    c -->|4,4| t
    b -->|8,8| t
```

### 8. Продолжим поиск увеличивающего пути

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 17 является максимальным для данной сети.

### 6. Проверим значение максимального потока перебором всех разрезов сети.

Разрез сети — разбиение множества вершин на два подмножества $V_1$ и $V_2$, где во множество $V_1$ входит источник, а в $V_2$ входит сток.

Пропускная способность разреза — сумма пропускной способности дуг, начинающихся в вершинах из множества $V_1$ и оканчивающихся в вершинах из $V_1$.

Для сети из n вершин существует $2^{n-2}$ различных разрезов, так как две вершины (источник и сток) «зафиксированы» в $V_1$ и $V_2$, остальные вершины можно различными способами распределять между множествами $V_1$ и $V_2$.

Для сети из 6 вершин нужно найти $2^{6-2}$ = $2^4$ = 16 разрезов.

| №   | V₁          | V₂          | Пропускная способность |
| --- | ----------- | ----------- | ---------------------- |
| 1   | {s}         | {a,b,c,d,t} | 10 + 7 = **17**        |
| 2   | {s,a}       | {b,c,d,t}   | 7 + 6 + 5 = 18         |
| 3   | {s,b}       | {a,c,d,t}   | 10 + 7 + 8 = 25        |
| 4   | {s,c}       | {a,b,d,t}   | 10 + 7 + 4 + 4 = 25    |
| 5   | {s,d}       | {a,b,c,t}   | 10 + 3 + 5 = 18        |
| 6   | {s,a,b}     | {c,d,t}     | 7 + 6 + 8 = 21         |
| 7   | {s,a,c}     | {b,d,t}     | 7 + 5 + 4 + 4 = 20     |
| 8   | {s,a,d}     | {b,c,t}     | 5 + 6 + 3 + 5 = 19     |
| 9   | {s,b,c}     | {a,d,t}     | 10 + 7 + 8 + 4 = 29    |
| 10  | {s,b,d}     | {a,c,t}     | 10 + 3 + 5 + 8 = 26    |
| 11  | {s,c,d}     | {a,b,t}     | 10 + 4 + 4 + 5 = 23    |
| 12  | {s,a,b,c}   | {d,t}       | 7 + 8 + 4 = 19         |
| 13  | {s,a,b,d}   | {c,t}       | 6 + 3 + 8 + 5 = 22     |
| 14  | {s,a,c,d}   | {b,t}       | 5 + 4 + 4 + 5 = 18     |
| 15  | {s,b,c,d}   | {a,t}       | 10 + 8 + 4 + 5 = 27    |
| 16  | {s,a,b,c,d} | {t}         | 8 + 4 + 5 = **17**     |

Минимальная пропускная способность разреза равна 17 (разрезы №1 и №16), что совпадает с найденной величиной максимального потока в сети.

### Ответ:

Максимальный поток в сети равен 17, он реализуется следующим локальными потоками:

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|10,10| a
    s -->|7,7| d
    a -->|5,6| c
    a -->|5,5| b
    d -->|2,3| c
    d -->|5,5| t
    c -->|3,4| b
    c -->|4,4| t
    b -->|8,8| t
```
