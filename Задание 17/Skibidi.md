# Вариант 7

#### Пропускная способность дуг сети (p(e)) и стоимость транспортировки единицы потока (c(e)):

| Дуги                                          |  sa |  sb |  sc |  ac |  at |  ab |  bd |  ct |  dt |
| :-------------------------------------------- | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: | :-: |
| Пропускная способность p(e)                   |  9  |  9  |  4  |  6  |  7  |  4  |  7  |  9  |  9  |
| Стоимость транспортировки единицы потока c(e) |  4  |  2  |  2  |  3  |  8  |  2  |  2  |  3  |  2  |

---

### 1. Построим сеть с источником **s**, стоком **t** и указанными пропускными способностями дуг.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|9| a
    s -->|9| b
    s -->|4| c
    a -->|6| c
    a -->|7| t
    a -->|4| b
    b -->|7| d
    c -->|9| t
    d -->|9| t
```

### 2. Построим остаточную сеть

```mermaid
graph RL
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    a -->|9| s
    b -->|9| s
    c -->|4| s
    c -->|6| a
    t -->|7| a
    b -->|4| a
    d -->|7| b
    t -->|9| c
    t -->|9| d
```

### 3. Поиск увеличивающих путей

**Путь 1:** t → a → s, Минимальный вес дуг на этом пути равен 7.
```mermaid
graph RL
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    a -->|9| s
    b -->|9| s
    c -->|4| s
    c -->|6| a
    t -->|7| a
    b -->|4| a
    d -->|7| b
    t -->|9| c
    t -->|9| d
    
    
    linkStyle 0 stroke:red,stroke-width:4px
    linkStyle 4 stroke:red,stroke-width:4px
```
```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|7,9| a
    s -->|0,9| b
    s -->|0,4| c
    a -->|0,6| c
    a -->|7,7| t
    a -->|0,4| b
    b -->|0,7| d
    c -->|0,9| t
    d -->|0,9| t
    
    linkStyle 0 stroke:red,stroke-width:4px
    linkStyle 4 stroke:red,stroke-width:4px
```
**Путь 2:** t → d → b → s, Минимальный вес дуг на этом пути равен 7.
```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    a -->|2| s
    b -->|9| s
    c -->|4| s
    c -->|6| a
    b -->|4| a
    d -->|7| b
    t -->|9| c
    t -->|9| d
    
    s -->|7| a
    a -->|7| t
    
    
    linkStyle 7 stroke:red,stroke-width:4px
    linkStyle 5 stroke:red,stroke-width:4px
    linkStyle 1 stroke:red,stroke-width:4px
```

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|7,9| a
    s -->|7,9| b
    s -->|0,4| c
    a -->|0,6| c
    a -->|7,7| t
    a -->|0,4| b
    b -->|7,7| d
    c -->|0,9| t
    d -->|7,9| t
    
    linkStyle 1 stroke:red,stroke-width:4px
    linkStyle 6 stroke:red,stroke-width:4px
    linkStyle 8 stroke:red,stroke-width:4px
```
**Путь 3:** t → c → s, Минимальный вес дуг на этом пути равен 4.
```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    a -->|2| s
    b -->|2| s
    c -->|4| s
    c -->|6| a
    b -->|4| a
    t -->|9| c
    t -->|2| d
    
    s -->|2| a
    a -->|7| t
    s -->|7| b
    b -->|7| d
    d -->|7| t
    
    linkStyle 5 stroke:red,stroke-width:4px
    linkStyle 2 stroke:red,stroke-width:4px
    
```

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|7,9| a
    s -->|7,9| b
    s -->|4,4| c
    a -->|0,6| c
    a -->|7,7| t
    a -->|0,4| b
    b -->|7,7| d
    c -->|4,9| t
    d -->|7,9| t
    
    linkStyle 2 stroke:red,stroke-width:4px
    linkStyle 7 stroke:red,stroke-width:4px
```
**Путь 3:** t → c → a → s, Минимальный вес дуг на этом пути равен 2.
```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    a -->|2| s
    b -->|2| s
    c -->|6| a
    b -->|4| a
    t -->|5| c
    t -->|2| d
    
    s -->|2| a
    a -->|7| t
    s -->|7| b
    b -->|7| d
    t -->|7| d
    c -->|4| t
    s -->|4| c
    
    linkStyle 4 stroke:red,stroke-width:4px
    linkStyle 2 stroke:red,stroke-width:4px
    linkStyle 0 stroke:red,stroke-width:4px
    
```

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|9,9| a
    s -->|7,9| b
    s -->|4,4| c
    a -->|2,6| c
    a -->|7,7| t
    a -->|0,4| b
    b -->|7,7| d
    c -->|6,9| t
    d -->|7,9| t
    
    linkStyle 0 stroke:red,stroke-width:4px
    linkStyle 3 stroke:red,stroke-width:4px
    linkStyle 7 stroke:red,stroke-width:4px
```

В остаточной сети не найдено увеличивающих путей, следовательно, алгоритм завершил работу и найденный поток величиной 20 является максимальным для данной сети.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| s
    c -->|4| a
    b -->|4| a
    t -->|3| c
    t -->|2| d
    s -->|9| a
    s -->|7| b
    s -->|4| c
    a -->|2| c
    a -->|7| t
    b -->|7| d
    c -->|6| t
    d -->|7| t

```
### 4. Рассчитаем стоимость полученного максимального потока.

| Дуги                                          | sa | sb | sc | ac | at | ab | bd | ct | dt |
| :-------------------------------------------- |:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность p(e)                   | 9  | 9  | 4  | 6  | 7  | 4  | 7  | 9  | 9  |
| Локальный поток f(e)                          | 9  | 7  | 4  | 2  | 7  | 0  | 7  | 6  | 7  |
| Стоимость транспортировки единицы потока c(e) | 4  | 2  | 2  | 3  | 8  | 2  | 2  | 3  | 2  |
| Суммарная стоимость f(e)*c(e)                 | 36 | 14 | 8  | 6  | 56 | 0  | 14 | 18 | 14 |
  
Итог 166
### 5. Попробуем уменьшить стоимость потока для чего построим остаточную сеть.
Для каждого ребра остаточной сети укажем стоимость транспортировки единицы потока.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| s
    c -->|3| a
    b -->|2| a
    t -->|3| c
    t -->|2| d
    s -->|-4| a
    s -->|-2| b
    s -->|-2| c
    a -->|-3| c
    a -->|-8| t
    b -->|-2| d
    c -->|-3| t
    d -->|-2| t
```

В остаточной сети найден ориентированный цикл отрицательной стоимости a -> t -> c -> a (- 8 + 3 + 3 = -2).

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| s
    c ==>|3| a 
    b -->|2| a
    t ==>|3| c
    t -->|2| d
    s -->|-4| a
    s -->|-2| b
    s -->|-2| c
    a -->|-3| c
    a ==>|-8| t
    b -->|-2| d
    c -->|-3| t
    d -->|-2| t
    
    linkStyle 1 stroke:red,stroke-width:4px
    linkStyle 3 stroke:red,stroke-width:4px
    linkStyle 9 stroke:red,stroke-width:4px
```

Найдем минимальный вес ребра в указанном цикле, изображенном в остаточной сети с указанием величины потока.


```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| s
    c -->|4| a
    b -->|4| a
    t -->|3| c
    t -->|2| d


    s -->|9| a
    s -->|7| b
    s -->|4| c
    a -->|2| c
    a -->|7| t
    b -->|7| d
    c -->|6| t
    d -->|7| t
    
    linkStyle 1 stroke:red,stroke-width:4px
    linkStyle 3 stroke:red,stroke-width:4px
    linkStyle 9 stroke:red,stroke-width:4px
```
Минимальный вес ребра в цикле 3 - это неиспользованный резерв ребра t -> c.

Удалим найденный цикл - уменьшим на 3 вес всех ребер, входящих в цикл.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| s
    c -->|1| a
    b -->|4| a
    t -->|2| d


    s -->|9| a
    s -->|7| b
    s -->|4| c
    a -->|2| c
    a -->|4| t
    t -->|3| a
    b -->|7| d
    c -->|9| t
    d -->|7| t
```

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|9,9| a
    s -->|7,9| b
    s -->|4,4| c
    a -->|5,6| c
    a -->|4,7| t
    a -->|0,4| b
    b -->|7,7| d
    c -->|9,9| t
    d -->|7,9| t
```
Скорректируем остаточную сеть с указанием стоимости транспортировки единицы потока.

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    b -->|2| s
    c -->|3| a
    b -->|2| a
    t -->|2| d
    s -->|-4| a
    s -->|-2| b
    s -->|-2| c
    a -->|-3| c
    a -->|-8| t
    b -->|-2| d
    c -->|-3| t
    d -->|-2| t
```
### 5. Проведем повторный поиск цикла отрицательной стоимости в остаточной сети.
В остаточной сети отсутствуют циклы отрицательной стоимости, следовательно, стоимость потока минимальна.

| Дуги                                          | sa | sb | sc | ac | at | ab | bd | ct | dt |
| :-------------------------------------------- |:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
| Пропускная способность p(e)                   | 9  | 9  | 4  | 6  | 7  | 4  | 7  | 9  | 9  |
| Локальный поток f(e)                          | 9  | 7  | 4  | 5  | 4  | 0  | 7  | 9  | 7  |
| Стоимость транспортировки единицы потока c(e) | 4  | 2  | 2  | 3  | 8  | 2  | 2  | 3  | 2  |
| Суммарная стоимость f(e)*c(e)                 | 36 | 14 | 8  | 15 | 32 | 0  | 14 | 27 | 14 |
  
Стоимость полученного потока составляет 160

### Ответ:
Максимальный поток в сети равен 20, минимальная стоимость потока 160, она реализуется следующим локальными потоками:

```mermaid
graph LR
    s(((s)))
    a((a))
    b((b))
    c((c))
    d((d))
    t(((t)))

    s -->|9,9| a
    s -->|7,9| b
    s -->|4,4| c
    a -->|5,6| c
    a -->|4,7| t
    a -->|0,4| b
    b -->|7,7| d
    c -->|9,9| t
    d -->|7,9| t
```